# 面试题（上）

1. ### 创建全平台兼容的XMLHttpRequest对象
   
   ```javascript
   function getXHR() {
     let xhr = null;
     if (window.XMLHttpRequest) {
       // 兼容 IE7+, Firefox, Chrome, Opera, Safari
       xhr = new XMLHttpRequest();
     } else if(window.ActiveXObject) {
       try {
         //  MSXML3
         xhr = new ActiveXObject('Msxml2.XMLHTTP');
       } catch (e) {
         try {
           //  兼容IE6, IE5，浏览器虽然支持但功能可能不完善，不推荐使用
           xhr = new ActiveXObject('Microsoft.XMLHTTP');
         } catch (e) {
           alert('您的浏览器暂不支持Ajax');
         }
       }
     }
     return xhr;
   }
   
   //  使用
   let xhr = getXHR();
   xhr.open('get', './api', true); //  第三个参数默认为true，是否异步
   xhr.onreadystatechange = function() {
     if (xhr.readyState == 4) {
       if (xhr.status == 200) {
         let result = xhr.responseText;
       }
     }
   }
   xhr.onerror = function(e) {
     console.log(e);
   }
   
   xhr.send();
   ```

1.1 readyState是XMLHttpRequest对象的一个属性，用来标识当前XMLHttpRequest对象处于什么状态。onreadystatechange函数的执行不是只在readyState变为4的时候触发的，而是readyState（2、3、4）

> `0：初始化，XMLHttpRequest对象还没有完成初始化`
> 
> `1：载入，XMLHttpRequest对象开始发送请求`
> 
> `2：载入完成，XMLHttpRequest对象的请求发送完成`
> 
> `3：解析，XMLHttpRequest对象开始读取服务器的响应`
> 
> `4：完成，XMLHttpRequest对象读取服务器响应结束`

1.2 status是XMLHttpRequest对象的一个属性，表示响应的HTTP状态码。在HTTP1.1协议下，HTTP状态码总共可分为5大类

> `1``xx：信息响应类，表示接收到请求并且继续处理`
> 
> `2``xx：处理成功响应类，表示动作被成功接收、理解和接受`
> 
> `3``xx：重定向响应类，为了完成指定的动作，必须接受进一步处理`
> 
> `4``xx：客户端错误，客户请求包含语法错误或者是不能正确执行`
> 
> `5``xx：服务端错误，服务器不能正确执行一个正确的请求`

2. ### JSONP跨域
   
   通过callback参数告诉服务器本地回调函数名字，服务器动态返回JSON数据
   
   ```javascript
   <script type="text/javascript">
         // 得到航班信息查询结果后的回调函数
         var flightHandler = function(data){
             alert('你查询的航班结果是：票价 ' + data.price + ' 元，' + '余票 ' + data.tickets + ' 张。');
         };
         // 提供jsonp服务的url地址（不管是什么类型的地址，最终生成的返回值都是一段javascript代码）
         var url = "http://flightQuery.com/jsonp/flightResult.aspx?code=CA1998&callback=flightHandler";
         // 创建script标签，设置其属性
         var script = document.createElement('script');
         script.setAttribute('src', url);
         // 把script标签加入head，此时调用开始
         document.getElementsByTagName('head')[0].appendChild(script); 
       </script>
   ```



3. ### 基本数据类型有哪些？null是对象吗？基本数据类型和复杂数据类型存储的区别？
   
   - 基本数据类型有6种，null, undefined, string, number, boolean, symbol
   
   - typeof null返回值虽然是object, 但null不是对象，是基本数据类型
   
   - 基本数据类型存储在栈内存中，存储的是值
   
   - 复杂数据类型存储在堆内存中，地址存储在栈内存中，把对象赋值给一个变量时，赋的是地址，指向同一块内存空间



4. ### typeof 是否正确判断类型? instanceof呢？ instanceof 的实现原理是什么
   
   - typeof 能够正确的判断基本数据类型，但是除了 null。
   
   - 对于对象，typeof只能判断function
   
   - instanceof 是通过原型链判断的，A instanceof B, 在A的原型链中层层查找，是否有原型等于B.prototype，如果一直找到A的原型链的顶端(null;即`Object.proptotype.__proto__`),仍然不等于B.prototype，那么返回false，否则返回true.
   
   - ```javascript
     function myInstanceOf(left, right) {
           while (left.__proto__) {
             if (left.__proto__ === right.constructor.prototype) {
               return true
             } else {
               left = left.__proto__
             }
           }
           return false
         }
     ```



5. 
